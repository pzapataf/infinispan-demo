<html ng-app id="ng-app">
<head>
    <style>
        body { background: lightblue; }
        canvas { background: #fff; margin: 20px; }
    </style>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
</head>
<body>

<canvas id="myCanvas" height="100" width="100"></canvas>

<div ng-controller="GridController">
    <button ng-click="loadData()">LOAD DATA</button>
    <button ng-click="runStep()">RUN STEP</button>
    {{canvasHeight}} x {{canvasWidth}}

</div>


<script type="text/javascript">

var paletteFireRed = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    		  0,0,0,0,0,0,4,4,4,4,4,4,4,8,8,8,8,8,12,12,12,12,16,16,16,16,20,20,20,24,24,
    		  24,28,28,32,32,32,36,36,40,40,44,44,48,48,52,52,56,56,60,60,64,68,68,72,72,
    		  76,80,80,84,88,88,92,92,96,100,100,104,108,108,112,116,120,120,124,128,128,
    		  132,136,136,140,144,144,148,152,152,156,160,160,164,164,172,172,172,176,176,
    		  180,184,184,188,188,192,192,196,196,200,200,204,204,208,208,208,212,212,216,
    		  216,220,220,220,220,224,224,224,228,228,228,228,232,232,232,232,236,236,236,
    		  236,236,240,240,240,240,240,240,240,244,244,244,244,244,244,244,244,244,244,
    		  248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,
    		  248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,
    		  248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,
    		  248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,
    		  248,248,248,248,248];

  var paletteFireGreen=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    		  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,8,8,8,8,
    		  8,8,8,8,8,12,12,12,12,12,12,16,16,16,16,16,16,20,20,20,20,20,24,24,24,24,28,
    		  28,28,28,32,32,32,32,36,36,36,36,40,40,40,44,44,44,48,48,48,52,52,52,56,56,
    		  56,60,60,60,64,64,64,68,68,72,72,72,76,76,80,80,80,84,84,84,88,88,92,92,92,
    		  96,96,100,100,104,104,104,108,108,112,112,116,116,116,120,120,124,124,128,
    		  128,128,132,132,136,136,140,140,140,144,144,148,148,148,152,152,156,156,160,
    		  160,163,164,164,168,168,168,172,172,172,176,176,180,180,180,184,184,184,188,
    		  188,188,192,192,192,196,196,200,200,200,200,200,204,204,204,208,208,208,208,
    		  212,212,212,212,216,216,216,216,220,220,220,220,220,224,224,224,224,224,228,
    		  228,228,228,228,228,232,232,232,232,232,232,236,236,236,236,236,236,236,236,
    		  240,240,240,240,240,240];

  var paletteFireBlue=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    		  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    		  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    		  0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
    		  4,4,8,8,8,2,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,12,12,12,12,12,12,12,12,12,12,
    		  12,12,12,12,12,12,12,16,16,16,16,16,16,16,16,16,16,16,16,16,16,20,20,20,20,
    		  20,20,20,20,20,20,20,20,24,24,24,24,24,24,24,24,24,24,24,24,28,28,28,28,28,
    		  28,28,28,28,28,32,32,32,32,32,32,32,32,32,32,36,36,36,36,36,36,36,36,36,40,
    		  40,40,40,40,40,40,40,44,44,44,44,44];


    function GridController($scope, $http) {
        
        $scope.init = function() {
            $scope.data = [];
            $scope.width = 100;
            $scope.height = 100;

            $scope.canvasPadding = 20;
            $scope.canvasWidth  = $scope.width * 5 + ($scope.canvasPadding * 2) + 1;
            $scope.canvasHeight = $scope.height* 5 + ($scope.canvasPadding * 2) + 1;

            var canvas = document.getElementById('myCanvas');
            canvas.width  = $scope.canvasWidth;
            canvas.height = $scope.canvasHeight;

        }
        
        $scope.refresh = function() {

        }

        $scope.paintData = function() {
            var canvas = document.getElementById('myCanvas');
            var context = canvas.getContext("2d");

            var data = $scope.data;

            $scope.paintGrid();

            for (var i = 0; i < data.length; i++) {
                var x = data[i].x * 5 + $scope.canvasPadding;
                var y = data[i].y * 5 + $scope.canvasPadding;
                var h = data[i].h; if( h < 0 ) h = 0; if( h > 255 ) h = 255;

                context.fillStyle = 'rgb(' + paletteFireRed[h] + ',' + paletteFireGreen[h] + ',' + paletteFireBlue[h] + ')';
                console.debug("Color" + context.fillStyle);
                context.fillRect(x,y,4,4);
            }
        }

        $scope.loadData = function() {

            $http({
              method: 'GET',
              url: '/rest/grid-status'
            }).then(function successCallback(response) {
              $scope.data = response.data;
              $scope.paintData();
              }, function errorCallback(response) {
                // TODO: Display error
            });
        }

        $scope.runStep = function() {

            $http({
              method: 'GET',
              url: '/rest/run-step'
            }).then(function successCallback(response) {
                $scope.loadData();
              }, function errorCallback(response) {
                // TODO: Display error
            });
        }



        $scope.paintGrid = function() {
            var width  = $scope.width;
            var height = $scope.height;
            var p = $scope.canvasPadding;

            var canvas = document.getElementById('myCanvas');

            var context = canvas.getContext("2d");


            context.fillStyle = 'white';
            context.fillRect(0,0,width*5,height*5);

            context.beginPath();


            for (var x = 0; x <= width*5; x += 5) {
                context.moveTo(0.5 + x + p, p);
                context.lineTo(0.5 + x + p, height * 5+ p);
            }

            for (var x = 0; x <= height*5; x += 5) {
                context.moveTo(p, 0.5 + x + p);
                context.lineTo(width * 5 + p, 0.5 + x + p);
            }

            context.strokeStyle = "#eeeeee";
            context.stroke();
         }


        $scope.init();
        $scope.paintGrid();
        $scope.loadData();
        $scope.paintData();
    }
</script>

</body>
</html>
